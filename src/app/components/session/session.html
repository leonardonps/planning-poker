<header>
	<h1>Planning Poker</h1>
	<ul id="settings-list">
		<li>
			<button
				type="button"
				[disabled]="!isOnline()"
				(click)="copySessionLink()"
			>
				<span class="material-symbols-outlined"> share </span>
			</button>
		</li>
		<li>
			<button type="button" (click)="toggleUserMode()" [disabled]="!isOnline()">
				<span class="material-symbols-outlined">
					{{ this.isObserver() ? 'person' : 'eyeglasses_2' }}
				</span>
			</button>
		</li>
		<li>
			<button
				type="button"
				(click)="onOpenSessionResultsModal()"
				[disabled]="!isOnline()"
			>
				<span class="material-symbols-outlined"> history </span>
			</button>
		</li>
	</ul>
</header>
<main>
	<div id="users">
		@for (user of this.presentUsers(); track $index; let i = $index) {
		<div class="user">
			@if (!user.isObserver) {
			<div
				class="user-estimate"
				[class.unselected-estimate]="user.estimate === null"
				[class.selected-estimate]="typeof user.estimate === 'number'"
			>
				{{ typeof this.avegareEstimate() === 'number' && user.estimate ?
				user.estimate : '?' }}
			</div>
			} @else {
			<div class="user-estimate unselected-estimate">
				<span class="material-symbols-outlined observer-icon"
					>eyeglasses_2</span
				>
			</div>
			}
			<div class="user-name">
				<strong>{{ user.name }}</strong>
			</div>
		</div>
		}
	</div>
	<div id="session-estimate-card">
		@if ( this.userEstimates().length > 0 && (typeof this.avegareEstimate() !==
		"number") ) {
		<button
			type="button"
			id="estimate-button"
			[disabled]="isUpdatingAverageEstimate() || !isOnline()"
			(click)="updateSessionAverageEstimate()"
		>
			Estimar
		</button>
		} @else if (typeof this.avegareEstimate() === "number") {
		<p>Estimativa da equipe:</p>
		<p id="session-average-estimate">{{ this.avegareEstimate() }}</p>
		<button
			type="button"
			id="restart-button"
			[disabled]="isUpdatingAverageEstimate() || !isOnline()"
			(click)="restartSessionAverageEstimate()"
		>
			Reiniciar
		</button>
		} @else {
		<p>
			Pelo menos, um participante precisa selecionar sua estimativa. Por favor,
			aguarde.
		</p>
		}
	</div>
	@if(!this.isOnline()) {
	<div class="warning-banner" data-type="offline">
		<p class="warning-banner-text">
			Conexão perdida. Por favor, verifique sua conexão com a internet.
		</p>
	</div>
	} @else if (!this.isObserver()) {
	<div id="estimate-options">
		<ul>
			@if (typeof this.avegareEstimate() !== 'number' && this.estimateOptions())
			{
			<li>
				<button
					type="button"
					class="material-icons"
					id="edit-estimate-options-button"
					(click)="onOpenEditEstimateOptionsModal()"
				>
					<span class="material-symbols-outlined"> edit </span>
				</button>
			</li>
			} @for (option of this.estimateOptions(); track $index) {
			<li>
				<button
					type="button"
					class="estimate-option"
					[class.selected-estimate-option]="
                option === this.selectedOption()
              "
					[class.estimate-option-highlight]="option !== this.selectedOption() && !this.avegareEstimate()"
					[disabled]="this.avegareEstimate()"
					(click)="selectEstimate(option)"
				>
					{{ option }}
				</button>
			</li>
			}
		</ul>
	</div>
	} @else {
	<div class="warning-banner" data-type="observer">
		<p class="warning-banner-text">
			Você está no modo de observador. Caso queira estimar também, clique no
			botão abaixo:
		</p>
		<button
			type="button"
			(click)="toggleUserMode()"
			id="toggle-user-mode-button"
		>
			Mudar para modo participante
		</button>
	</div>
	}
</main>
<ng-container #toast></ng-container>
<ng-container #modal></ng-container>
<ng-container #loading><ng-container></ng-container></ng-container>
